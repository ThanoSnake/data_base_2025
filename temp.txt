🔹 Trigger: check_event_overlap
Περιγραφή:
🔹 Trigger: check_event_overlap
Περιγραφή:
Το trigger check_event_overlap ενεργοποιείται πριν την εισαγωγή ενός νέου event στον πίνακα event και εκτελεί μια σειρά από ελέγχους που εξασφαλίζουν τη χρονική συνοχή και τη συμμόρφωση με τους κανόνες του φεστιβάλ. Αρχικά, ελέγχει ότι οι ημερομηνίες και ώρες του event βρίσκονται εντός του εύρους ημερομηνιών του αντίστοιχου φεστιβάλ (festival.start_date έως festival.end_date). Στη συνέχεια, επιβεβαιώνει ότι δεν υπάρχει ήδη άλλο event που να πραγματοποιείται στην ίδια σκηνή (stage_id) και να επικαλύπτεται χρονικά με το νέο. Τέλος, εξετάζει αν η προσθήκη του event παραβιάζει τη μέγιστη ημερήσια διάρκεια φεστιβάλ για τη συγκεκριμένη ημέρα — η συνολική διάρκεια όλων των events ανά ημέρα δεν πρέπει να υπερβαίνει τα 780 λεπτά (δηλαδή 13 ώρες). Αν παραβιαστεί οποιοσδήποτε από αυτούς τους περιορισμούς, η εισαγωγή απορρίπτεται με κατάλληλο μήνυμα σφάλματος




🔹 Trigger: check_staff_assignments
Περιγραφή:
Το trigger check_staff_assignments ενεργοποιείται πριν την εισαγωγή μιας νέας ανάθεσης προσωπικού στον πίνακα staff_event και διασφαλίζει την εγκυρότητα της συσχέτισης μεταξύ εργαζομένου και event. Αρχικά, εντοπίζει τον ρόλο του υπαλλήλου από τον πίνακα staff και τις χρονικές πληροφορίες του αντίστοιχου event από τον πίνακα event. Στη συνέχεια, ελέγχει αν ο υπάλληλος είναι ήδη ανατεθειμένος σε κάποιο άλλο event που επικαλύπτεται χρονικά με το νέο, ώστε να αποτρέπεται η ταυτόχρονη συμμετοχή σε πολλαπλές εκδηλώσεις. Επιπλέον, αν ο υπάλληλος ανήκει στο τεχνικό προσωπικό, γίνεται επιπλέον έλεγχος για το πλήθος των αναθέσεων μέσα στην ίδια ημέρα — δεν επιτρέπεται να συμμετέχει σε περισσότερα από δύο events ημερησίως. Αν παραβιαστεί κάποιος από τους παραπάνω κανόνες, η εισαγωγή μπλοκάρεται με σχετικό μήνυμα σφάλματος, εξασφαλίζοντας έτσι την ορθολογική κατανομή του προσωπικού και την αποφυγή υπερφόρτωσης.




Η procedure validate_event_staffing ελέγχει τη σωστή στελέχωση προσωπικού για κάθε event, βάσει προκαθορισμένων ποσοστιαίων ορίων ανά ρόλο. Για κάθε event, γίνεται σύγκριση του αριθμού του προσωπικού με τη μέγιστη χωρητικότητα της σκηνής στην οποία λαμβάνει χώρα, εξασφαλίζοντας ότι υπάρχουν τουλάχιστον 1 τεχνικός, τουλάχιστον 5% του μέγιστου κοινού σε άτομα ασφαλείας, και τουλάχιστον 2% σε βοηθητικό προσωπικό. Αν για οποιοδήποτε event δεν ικανοποιούνται αυτοί οι ελάχιστοι αριθμοί, παράγεται σφάλμα που μπλοκάρει την εκτέλεση και επιστρέφει σχετικό μήνυμα. Με αυτόν τον τρόπο διασφαλίζεται ότι κάθε event έχει την ελάχιστη απαραίτητη κάλυψη σε κρίσιμες θέσεις εργασίας για την ομαλή και ασφαλή διεξαγωγή του.
